<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <title>Vicky Mini NetFlix</title>
</head>
<body>
  <div class="col-lg-6 col-sm-12 px-5 fw-ligther text-center">
    <h1>Upload Your Movie Here</h1>
    <input type="text" placeholder="Movie Title" id="movieTitle" class="form-control px-3 mt-2 fw-ligther">
    <input type="text" placeholder="Movie Duration" id="movieDuration" class="form-control px-3 mt-2 fw-ligther">
    <input type="text" placeholder="Movie Genre" id="movieGenre" class="form-control px-3 mt-2 fw-ligther">
    <input type="text" placeholder="Movie Cast" id="movieCast" class="form-control px-3 mt-2 fw-ligther">
    <input type="text" placeholder="Movie Synopsis" id="movieSynopsis" class="form-control px-3 mt-2 fw-ligther">
    <input type="file" id="movieFile" class="form-control">
    <button id="uploadBtn" class="btn btn-info fw-ligther px-5">Upload Your Movie</button>
  </div>
      <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
        import { getDatabase,ref,set,onValue} from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";
        import { getStorage,ref as stRef,uploadBytesResumable} from "https://www.gstatic.com/firebasejs/9.17.1/firebase-storage.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyAQUmj8z7qrFOUHg4vx4Pms9-tbRkloSzM",
          authDomain: "vicky-mini-netflix.firebaseapp.com",
          databaseURL: "https://vicky-mini-netflix-default-rtdb.firebaseio.com",
          projectId: "vicky-mini-netflix",
          storageBucket: "vicky-mini-netflix.appspot.com",
          messagingSenderId: "411800314714",
          appId: "1:411800314714:web:7b5c43e5cc1b58e9c0c963"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase();
        const storage = getStorage()
        let movieIndex = 0 

        
        uploadBtn.addEventListener("click",()=>{
          let file = movieFile.files[0]
          let filename = file.name
            let movie = {
                title : movieTitle.value,
                Duration : movieDuration.value,
                Genre : movieGenre.value,
                Cast : movieCast.value,
                Synopsis :movieSynopsis.value,
            }
            console.log(movie)
            let movieRef = ref(database,`Movies/${movieIndex}`)
            set(movieRef,movie)
            let movieStRef = StRef(storage,`${filename}`)
            const uploadTask = uploadBytesResumable(movieStRef,file)
            uploadTask.on("state-changed",(snapshot)=>{
              console.log((snapshot.bytesTransferred/snapshot.totalBytes)*100)
          },(error)=>{
            console.log(err)
          },()=>{
            console.log("upload complete")
          })
        })
        let allMovieRef = ref(database,"Movies")
        onValue(allMovieRef,(snapshot)=>{
          let data = snapshot.val()
          if(data){
            movieIndex = data.length
          }else{
            movieIndex = 0
          }})
          console.log(window)
    </script>
</body>
</html>